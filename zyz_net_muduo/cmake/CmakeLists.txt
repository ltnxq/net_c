cmake_minimum_required (VERSION 2.6)
project (Tutorial 
        VERSION 1.2.3 
        DESCRIPTION "this is decrption"
        LANGUAGES CXX
)

#------------------------日志输出---------------------------------------------------
message(STATUS ${PROJECT_VERSION})
message(STATUS ${PROJECT_DESCRIPTION})


# The version number.
set (Tutorial_VERSION_MAJOR 1)
set (Tutorial_VERSION_MINOR 0)


#-----------------------------添加系统自检--------------------------------------------------
#必须在配置文件前面添加这几行命令,配合配置文件使用
#does this system provide the log and exp function
include (${CMAKE_ROOT}/Modules/CheckFunctionExists.cmake)
check_function_exists(log HAVE_LOG)
check_function_exists(exp HAVE_EXP)

 
# configure a header file to pass some of the CMake settings
# to the source code
#------------------------------在配置文件TutorialConfig.h.in增加配置-------------------------------------------

configure_file (
  "${PROJECT_SOURCE_DIR}/TutorialConfig.h.in"
  "${PROJECT_BINARY_DIR}/TutorialConfig.h"
  )
 
# add the binary tree to the search path for include files
# so that we will find TutorialConfig.h
include_directories("${PROJECT_BINARY_DIR}")

#--------------------------------增加开关控制 option-------------------------------------
option (USE_MYMATH 
        "Use tutorial provided math implementation" ON)

#增加开关控制
if(USE_MYMATH)
   include_directories("${PROJECT_BINARY_DIR}/mathfunction")
   add_subdirectory(./mathfunction)
   set(EXTRA_LIBS  MathFunctions)
endif(USE_MYMATH)



# add the executable
add_executable(Tutorial tutorial.cpp)
target_link_libraries(Tutorial ${EXTRA_LIBS})

#------------------------------------make install 添加头文件和执行文件--------------------------
#根目录下添加 add the install targets
#install 一般的命令需要root权限的 命令执行是sudo make install
install(TARGETS Tutorial DESTINATION bin)
install(FILES "${PROJECT_BINARY_DIR}/TutorialConfig.h" DESTINATION include)

#----------------------------------------------------------添加测试程序--------------------------
enable_testing ()

add_test(TutorialRuns Tutorial 25)

add_test(TutorialComp25 Tutorial 25)
#使用 PASS_REGULAR_EXPRESSION 测试属性来测试的输出是否包含特定的字符串
set_tests_properties(TutorialComp25 PROPERTIES PASS_REGULAR_EXPRESSION "25 is 5"  )

# does it handle negative numbers
add_test (TutorialNegative Tutorial -25)
set_tests_properties (TutorialNegative PROPERTIES PASS_REGULAR_EXPRESSION "-25 is 0")
# does it handle small numbers
add_test (TutorialSmall Tutorial 0.0001)
set_tests_properties (TutorialSmall PROPERTIES PASS_REGULAR_EXPRESSION "0.0001 is 0.01")
# does the usage message work?
add_test (TutorialUsage Tutorial)
set_tests_properties (TutorialUsage PROPERTIES PASS_REGULAR_EXPRESSION "Usage:.*number")

#增加宏来测试不同的输入值
macro (do_test arg result)
  add_test(TutorialComp${arg} Tutorial ${arg})
  set_tests_properties(TutorialComp${arg} PROPERTIES PASS_REGULAR_EXPRESSION ${result})
endmacro(do_test)

#do a banch of result based test
do_test(16 "16 is 4")
do_test(-16, "-16 is 0")

